


import com.app.process.FundTransferService;
import com.app.process.AccountService;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.Mockito;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.Mockito.*;

public class FundTransferServiceTest {

    private AccountService accountService;
    private FundTransferService fundTransferService;

    @BeforeEach
    public void setUp() {
        accountService = Mockito.mock(AccountService.class);
        fundTransferService = new FundTransferService(accountService);
    }

    // ✅ Test 1: Invalid amount
    @Test
    public void testInvalidAmount() {
        String result = fundTransferService.transfer("A101", "B202", -500);
        assertEquals("FAILURE: Invalid amount", result);
    }

    // ✅ Test 2: Same account transfer
    @Test
    public void testSameAccountTransfer() {
        String result = fundTransferService.transfer("A101", "A101", 100);
        assertEquals("FAILURE: Source and destination cannot be same", result);
    }

    // ✅ Test 3: Insufficient funds
    @Test
    public void testInsufficientFunds() {
        when(accountService.getBalance("A101")).thenReturn(100.0);

        String result = fundTransferService.transfer("A101", "B202", 500);

        assertEquals("FAILURE: Insufficient funds", result);
        verify(accountService).getBalance("A101");
    }

    // ✅ Test 4: Destination account not found
    @Test
    public void testDestinationAccountNotFound() {
        when(accountService.getBalance("A101")).thenReturn(1000.0);
        when(accountService.exists("B202")).thenReturn(false);

        String result = fundTransferService.transfer("A101", "B202", 200);

        assertEquals("FAILURE: Destination account not found", result);
    }

    // ✅ Test 5: Successful transfer
    @Test
    public void testSuccessfulTransfer() {
        when(accountService.getBalance("A101")).thenReturn(1000.0);
        when(accountService.exists("B202")).thenReturn(true);
        when(accountService.debit("A101", 200)).thenReturn(true);
        when(accountService.credit("B202", 200)).thenReturn(true);

        String result = fundTransferService.transfer("A101", "B202", 200);

        assertEquals("SUCCESS: Transfer completed", result);
    }

    // ✅ Test 6: Transaction error (either debit or credit fails)
    @Test
    public void testTransactionError() {
        when(accountService.getBalance("A101")).thenReturn(1000.0);
        when(accountService.exists("B202")).thenReturn(true);
        when(accountService.debit("A101", 200)).thenReturn(true);
        when(accountService.credit("B202", 200)).thenReturn(false);

        String result = fundTransferService.transfer("A101", "B202", 200);

        assertEquals("FAILURE: Transaction error", result);
    }
}
